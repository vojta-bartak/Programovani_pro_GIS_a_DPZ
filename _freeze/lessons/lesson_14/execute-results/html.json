{
  "hash": "0be8a446928d06071e091c0132228120",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Lekce 14: Atributové operace\"\nsubtitle: \"Python pro GIS - Práce s tabulkami a poli\"\nauthor: \"Vojtěch Barták, FŽP ČZU Praha\"\ndate: today\nformat:\n  html:\n    toc: true\n    toc-depth: 3\n    number-sections: true\n    number-depth: 3\n    code-fold: false\n    theme: cosmo\n  pdf:       \n    toc: true\n    toc-depth: 3\n    number-sections: true\n    number-depth: 3\neditor: \n  markdown: \n    wrap: 72\n---\n\n\\newpage\n\n# Data a nastavení\n\n**Data ke stažení:**\n\n**Z Lekce 13 (rastrové analýzy):**\n- `katastry_Liberec.shp` - katastry v Libereckém kraji\n- `okresy.shp` - okresy\n\n**Data pro atributové operace (`data_odtoky/`):**\n- `UrbanAtlas_LK.shp` - krajinný pokryv Urban Atlas pro Liberecký kraj\n- `obce_LK.shp` - obce v Libereckém kraji\n- `coef.dbf` - tabulka součinitelů odtoku pro typy povrchu\n\n**Z ArcČR500:**\n- `Sidla.shp` - sídla v ČR\n- `Silnice.shp` - silniční síť\n- `VUSC.shp` - kraje\n- `Okresy_VUSC.shp` - okresy s kódem kraje\n- `Sidla_pocty.dbf` - tabulka s počty obyvatel sídel\n\n**Nastavení prostředí:**\n\n```python\nimport arcpy\n\n# Workspace\narcpy.env.workspace = r\"C:\\TEMP\\Python_GIS\\Lekce_14\"\narcpy.env.overwriteOutput = True\n```\n\n::: {.callout-note}\n## Pracovní prostředí\n\n**Úlohy 1-20** řešte v **IDLE** nebo v **Python Window** v ArcGIS Pro.\n\n**Úlohy 21-22** (komplexní analýzy) řešte v **Python Notebooku**.\n:::\n\n------------------------------------------------------------------------\n\n# Úvod\n\nV této lekci probereme operace, které jste většinou zvyklí v grafickém prostředí ArcGIS provádět \"ručně\", často kliknutím pravým tlačítkem myši na pole atributové tabulky či vrstvu a výběrem nástroje z kontextového menu. Tyto operace zahrnují například:\n\n- Přidání nového pole do atributové tabulky\n- Smazání existujícího pole atributové tabulky\n- Výpočet hodnot pole pomocí *Field Calculator*, případně *Calculate Geometry*\n- Sumarizaci hodnot pole/polí atributové tabulky\n- Propojení tabulek pomocí *Join*\n- Atributový výběr prvků pomocí SQL dotazu\n\nKe všem těmto \"ručním\" operacím existují odpovídající geoprocessingové nástroje z ArcToolboxu, které umožňují jejich provádění v rámci modelů z Model Builderu či v rámci skriptů v Pythonu. Většina z nich je umístěná v nástrojovém balíčku *Data Management Tools*.\n\n------------------------------------------------------------------------\n\n# Práce s vrstvami\n\nNež se pustíme do práce s poli a tabulkami, je důležité pochopit rozdíl mezi **datovou sadou** (data uložená na disku) a **vrstvou** (pohled na data v paměti).\n\n**Datová sada** (feature class, shapefile) je fyzický soubor s daty uloženými na disku. Když s ní pracujeme v Pythonu, přímo měníme data na disku.\n\n**Vrstva** (layer) je dočasný pohled na datovou sadu, který existuje pouze v operační paměti. Vrstva může mít definovaný výběr prvků, symbologii, propojení s jinými tabulkami atd. Když zavřeme ArcGIS Pro (nebo smažeme vrstvu), vrstva zmizí, ale původní data zůstávají nedotčená.\n\n## Úloha 1: Vytvoření vrstvy\n\n**Zadání:** Vytvořte vrstvu z `katastry_Liberec.shp` s názvem \"katastry_layer\".\n\nVrstva se vytváří nástrojem **Make Feature Layer** z balíčku *Data Management Tools*. Prvním parametrem je cesta k datové sadě, z níž chceme vrstvu vytvořit, druhým parametrem je název vrstvy. Výsledek volání nástroje (objekt třídy *Result*) můžeme uložit do proměnné, která bude následně vrstvu zastupovat v dalších nástrojích.\n\n```python\n# Vytvoření vrstvy\nkatastry_lyr = arcpy.management.MakeFeatureLayer(\n    \"katastry_Liberec.shp\", \n    \"katastry_layer\"\n)\n\nprint(\"Vrstva vytvořena\")\n\n# Výpis názvů polí vrstvy\nprint(\"\\nPole v tabulce:\")\nfor field in arcpy.ListFields(katastry_lyr):\n    print(f\"  {field.name}\")\n```\n\n::: {.callout-important}\n## Zamykání dat\n\nKdyž z datové sady vytvoříte vrstvu pomocí `MakeFeatureLayer`, tato datová sada se \"zamkne\" - vytvoří se k ní soubor zámku, zamezující jakémukoli programu provádět v datové sadě změny. \n\nPokud budete chtít v datové sadě přidávat či mazat pole, nebude to možné, pokud je z ní vytvořena vrstva. Po smazání vrstvy nástrojem `Delete` se soubor zámku smaže a datová sada se odemkne pro úpravy.\n:::\n\n## Úloha 2: Atributový výběr\n\n**Zadání:** Z vrstvy katastrů vyberte pouze ty, které mají v názvu slovo \"Liberec\".\n\nAtributový výběr se provádí nástrojem **Select Layer By Attribute**. Tento nástroj používá SQL syntaxi pro definici podmínek výběru.\n\n```python\n# Výběr katastrů s \"Liberec\" v názvu\narcpy.management.SelectLayerByAttribute(\n    katastry_lyr,\n    \"NEW_SELECTION\",\n    \"NAZEV LIKE '%Liberec%'\"\n)\n\n# Zjištění počtu vybraných prvků\nresult = arcpy.management.GetCount(katastry_lyr)\ncount = int(result.getOutput(0))\nprint(f\"Vybráno katastrů: {count}\")\n```\n\n**Parametry:**\n\n- První parametr: vrstva\n- Druhý parametr: typ výběru\n  - `\"NEW_SELECTION\"` - nový výběr (smaže předchozí)\n  - `\"ADD_TO_SELECTION\"` - přidá k výběru\n  - `\"REMOVE_FROM_SELECTION\"` - odebere z výběru\n  - `\"CLEAR_SELECTION\"` - smaže výběr\n- Třetí parametr: SQL podmínka (where clause)\n\n**SQL operátory:**\n\n- `LIKE` - hledání vzoru (% = libovolné znaky)\n- `=`, `<>`, `>`, `<`, `>=`, `<=` - porovnání\n- `AND`, `OR`, `NOT` - logické operátory\n- `IN (hodnota1, hodnota2, ...)` - jeden z hodnot\n\n:::{.callout-note}\nVytvoření vrstvy s výběrem lze provést v jediném kroku. Nástroj `MakeFeatureLayer` má totiž nepovinný parametr, ve kterém je možné přímo zadat SQL dotaz. Vrstva se pak vytvoří rovnou s výběrem. \n\nK čemu je tedy vytváření vrstvy v samostatném kroku? Umožňuje např. vytvořit nejprve vrstvu pomocí `MakeFeatureLayer` a následně v ní v cyklu dynamicky měnit výběr pomocí `SelectLayerByAttribute` a provádět nějakou analýzu jen s příslušným výběrem.\n:::\n\n## Úloha 3: Kombinace podmínek\n\n**Zadání:** Z vrstvy obcí vyberte obce s počtem obyvatel větším než 5000 **A ZÁROVEŇ** s rozlohou menší než 20 km².\n\n```python\n# Nejprve vytvoříme vrstvu z obcí\nobce_lyr = arcpy.management.MakeFeatureLayer(\"obce_LK.shp\", \"obce_layer\")\n\n# Přidáme pole pro plochu (bude potřeba pro podmínku)\narcpy.management.AddField(obce_lyr, \"AREA_KM\", \"DOUBLE\")\narcpy.management.CalculateField(\n    obce_lyr, \n    \"AREA_KM\", \n    '!shape.area!/1000000', \n    \"PYTHON3\"\n)\n\n# Výběr s kombinací podmínek\narcpy.management.SelectLayerByAttribute(\n    obce_lyr,\n    \"NEW_SELECTION\",\n    \"OBYVATEL > 5000 AND AREA_KM < 20\"\n)\n\n# Uložení výběru do nového shapefile\narcpy.management.CopyFeatures(obce_lyr, \"obce_velke_kompaktni.shp\")\n\nprint(\"Výběr uložen\")\n```\n\n## Úloha 4: Tabulkový pohled\n\n**Zadání:** Vytvořte tabulkový pohled na `Sidla_pocty.dbf` obsahující pouze sídla s počtem obyvatel větším než 10000.\n\nPro samostatné tabulky (ne prostorové vrstvy) se místo `MakeFeatureLayer` používá **Make Table View**:\n\n```python\n# Vytvoření tabulkového pohledu s filtrem\nsidla_view = arcpy.management.MakeTableView(\n    \"Sidla_pocty.dbf\",\n    \"sidla_view\",\n    \"POCET_OB > 10000\"\n)\n\n# Zjištění počtu záznamů\nresult = arcpy.management.GetCount(sidla_view)\nprint(f\"Velkých sídel: {result.getOutput(0)}\")\n```\n\n------------------------------------------------------------------------\n\n# Práce s poli\n\nNástroje pro práci s poli atributových tabulek, jako je přidání pole, smazání pole, či výpočet hodnot pole, nalezneme v nástrojové sadě *Data Management Tools → Fields*.\n\n## Úloha 5: Přidání pole\n\n**Zadání:** Do `obce_LK.shp` přidejte nové pole \"AREA_KM\" typu DOUBLE.\n\n**Přidání pole** se provádí nástrojem **Add Field**. Jeho použití si předvedeme na příkladu přidání číselného pole do tabulky vrstvy obcí.\n\n```python\nobce = \"obce_LK.shp\"\n\n# Přidání číselného pole\narcpy.management.AddField(obce, \"AREA_KM\", \"DOUBLE\")\n\nprint(\"Pole AREA_KM přidáno\")\n```\n\n**Parametry:**\n\n- První parametr: název vstupní tabulky (může být vektorová třída prvků nebo samostatná tabulka)\n- Druhý parametr: název přidávaného pole\n- Třetí parametr: datový typ pole\n\n**Běžné datové typy:**\n\n- `\"TEXT\"` - textový řetězec\n- `\"DOUBLE\"` - desetinné číslo\n- `\"LONG\"` - celé číslo\n- `\"SHORT\"` - krátké celé číslo\n- `\"DATE\"` - datum\n\n::: {.callout-warning}\n## Pozor na existující pole!\n\nPři přidávání pole je třeba dávat pozor na to, zda pole s daným názvem již v tabulce není. Pokud ano, nástroj *Add Field* pole přidá a pouze na existenci původního pole se stejným názvem upozorní hláškou typu \"Warning\". Tím se ovšem původní pole nenávratně smaže.\n:::\n\nExistující pole (pokud není povinné, jako např. pole FID či Shape) lze smazat pomocí nástroje **Delete Field**:\n\n```python\n# Smazání pole\narcpy.management.DeleteField(obce, \"AREA_KM\")\n```\n\n## Úloha 6: Výpočet konstantní hodnoty\n\n**Zadání:** Vytvořte pole \"KRAJ\" a vyplňte ho konstantou \"Liberecký\".\n\nVýpočet hodnot pole tabulky se provádí nástrojem **Calculate Field** z nástrojové sady *Fields*. Prvním parametrem je cesta ke vstupní datové sadě, druhým název pole, které chceme vypočítat. Následuje výraz výpočtu.\n\n```python\nobce = \"obce_LK.shp\"\n\n# Přidání textového pole\narcpy.management.AddField(obce, \"KRAJ\", \"TEXT\")\n\n# Vyplnění pole konstantou\narcpy.management.CalculateField(obce, \"KRAJ\", '\"Liberecký\"')\n\nprint(\"Pole KRAJ vyplněno\")\n```\n\nVšimněte si, že v případě textového atributu bylo třeba výraz \"Liberecký\" napsat pomocí obou typů uvozovek: `'\"Liberecký\"'`. To proto, že součástí výrazu musí v případě textu být i uvozovky, přičemž samotný výraz je nástroji předáván také jako text. Vnější, jednoduché uvozovky ohraničují celý text výrazu, kdežto vnitřní, dvojité uvozovky jsou již součástí výrazu samotného a sdělují, že obsah výrazu je text.\n\n**Podobně pro číselné pole:**\n\n```python\n# Přidání číselného pole\narcpy.management.AddField(obce, \"CONST\", \"LONG\")\n\n# Vyplnění konstantou\narcpy.management.CalculateField(obce, \"CONST\", 100)\n```\n\n## Úloha 7: Výpočet z jiného pole\n\n**Zadání:** Vytvořte pole \"NAZEV_UPPER\" a zkopírujte do něj názvy obcí převedené na velká písmena.\n\nPři vyplňování pole je možné použít hodnoty kteréhokoli jiného, již existujícího pole. Na toto pole se lze odkázat jeho názvem, uvedeným mezi vykřičníky. Je přitom možné hodnoty různých polí libovolně kombinovat, provádět s nimi výpočty apod. Ve výrazu je možné použít jakoukoli funkci či operaci, která je součástí základní výbavy Pythonu. Čtvrtým, volitelným parametrem nástroje *Calculate Field* specifikujeme, že používáme jazyk Python 3.\n\n```python\nobce = \"obce_LK.shp\"\n\n# Přidání nového pole\narcpy.management.AddField(obce, \"NAZEV_UPPER\", \"TEXT\")\n\n# Vyplnění pole s použitím metody upper()\narcpy.management.CalculateField(\n    obce, \n    \"NAZEV_UPPER\", \n    '!NAZEV!.upper()', \n    \"PYTHON3\"\n)\n\nprint(\"Názvy převedeny na velká písmena\")\n```\n\nVšimněte si použití vykřičníků pro odkaz na pole \"NAZEV\" v rámci výrazu, a na použití metody `.upper()` pro převod na velká písmena.\n\n:::{.callout-tip}\n**Užitečné metody pro textové řetězce:**\n\n- `.upper()` - převod na velká písmena\n- `.lower()` - převod na malá písmena\n- `.replace(old, new)` - nahrazení textu\n- `.strip()` - odstranění bílých znaků\n:::\n\n## Úloha 8: Výpočet plochy\n\n**Zadání:** Vypočítejte plochu katastrů v km² do pole \"AREA_KM\".\n\nVelmi častou úlohou je výpočet geometrických vlastností prvků do atributu. \"Ruční\" řešení by spočívalo v použití nástroje *Calculate Geometry* dostupného v kontextovém menu příslušného pole. V Pythonu se operace provede pomocí nástroje *Calculate Field*, kde se v rámci výrazu odkážeme na speciální pole `!shape.area!`:\n\n```python\nkatastry = \"katastry_Liberec.shp\"\n\n# Přidání pole pro plochu\narcpy.management.AddField(katastry, \"AREA_KM\", \"DOUBLE\")\n\n# Výpočet plochy v km² (shape.area je v m²)\narcpy.management.CalculateField(\n    katastry, \n    \"AREA_KM\", \n    '!shape.area!/1000000', \n    \"PYTHON3\"\n)\n\nprint(\"Plochy vypočítány\")\n```\n\n## Úloha 9: Výpočet obvodu\n\n**Zadání:** Vypočítejte obvod polygonů Urban Atlas v km do pole \"PERIMETER_KM\".\n\n```python\nurban_atlas = \"UrbanAtlas_LK.shp\"\n\n# Přidání pole\narcpy.management.AddField(urban_atlas, \"PERIMETER_KM\", \"DOUBLE\")\n\n# Výpočet obvodu v km (shape.length je v m)\narcpy.management.CalculateField(\n    urban_atlas,\n    \"PERIMETER_KM\",\n    '!shape.length!/1000',\n    \"PYTHON3\"\n)\n\nprint(\"Obvody vypočítány\")\n```\n\n## Úloha 10: Výpočet délky linií\n\n**Zadání:** Vypočítejte délku silnic v km do pole \"LENGTH_KM\".\n\n```python\nsilnice = \"Silnice.shp\"\n\n# Přidání pole\narcpy.management.AddField(silnice, \"LENGTH_KM\", \"DOUBLE\")\n\n# Výpočet délky (shape.length u linií)\narcpy.management.CalculateField(\n    silnice,\n    \"LENGTH_KM\",\n    '!shape.length!/1000',\n    \"PYTHON3\"\n)\n\nprint(\"Délky silnic vypočítány\")\n```\n\n**Geometrické vlastnosti:**\n\n- **Polygony:**\n  - `!shape.area!` - plocha (v m²)\n  - `!shape.length!` - obvod (v m)\n  \n- **Linie:**\n  - `!shape.length!` - délka (v m)\n  \n- **Body:**\n  - `!shape.X!` - souřadnice X\n  - `!shape.Y!` - souřadnice Y\n\n## Úloha 11: Perimeter-Area Ratio\n\n**Zadání:** Do `UrbanAtlas_LK.shp` přidejte pole \"PA_RATIO\" a vypočtěte do něj poměr obvodu a plochy.\n\nPerimeter-Area Ratio je krajinná metrika popisující míru složitosti tvaru krajinných plošek. Čím je hodnota vyšší, tím je tvar složitější (členitější okraj).\n\n```python\nurban_atlas = \"UrbanAtlas_LK.shp\"\n\n# Přidání pole\narcpy.management.AddField(urban_atlas, \"PA_RATIO\", \"DOUBLE\")\n\n# Výpočet PA_RATIO = obvod / plocha\narcpy.management.CalculateField(\n    urban_atlas,\n    \"PA_RATIO\",\n    '!shape.length!/!shape.area!',\n    \"PYTHON3\"\n)\n\nprint(\"PA_RATIO vypočítán\")\n```\n\n------------------------------------------------------------------------\n\n# Propojování tabulek\n\nPropojení tabulek pomocí metody *join* má za následek přidání pole (či polí) z připojované tabulky do cílové tabulky, a to na základě nějakého společného atributu (tzv. *klíče*). Tento typ propojení je možný v případě, kdy jednomu řádku cílové tabulky odpovídá max. jeden řádek připojované tabulky. Zároveň platí, že jednomu řádku připojované tabulky může odpovídat jeden či více řádků cílové tabulky.\n\nPropojení metodou *join* lze v praxi provést dvěma způsoby:\n\n- jako **dočasné propojení**, které je definované pouze v rámci vrstev\n- jako **permanentní** rozšíření cílové tabulky o nové sloupce\n\n## Dočasné propojení\n\nDočasné propojení je právě ten způsob, který jste pravděpodobně zvyklí provádět v prostředí ArcGIS \"ručně\".\n\nJelikož je dočasné propojení definováno na úrovni vrstvy, nikoli datové sady, je pro jeho použití pomocí Pythonu třeba nejprve vytvořit ze zdrojové sady vrstvu. Vrstva se vytvoří v operační paměti a bude uložena do proměnné, pomocí které s ní bude možné pracovat.\n\n## Úloha 12: Dočasné propojení\n\n**Zadání:** K vrstvě `UrbanAtlas_LK.shp` dočasně připojte tabulku `coef.dbf` podle pole CODE.\n\n```python\n# Vstupní data\nland_cover = \"UrbanAtlas_LK.shp\"\ncoef_table = \"coef.dbf\"\n\n# Vytvoření vrstvy\nlyr = arcpy.management.MakeFeatureLayer(land_cover, \"ua_layer\")\n\n# Připojení tabulky\narcpy.management.AddJoin(lyr, \"CODE\", coef_table, \"CODE\")\n\n# Výpis názvů polí připojené vrstvy\nprint(\"Pole v připojené tabulce:\")\nfor field in arcpy.ListFields(lyr):\n    print(f\"  {field.name}\")\n```\n\nVýsledek:\n\n```\nPole v připojené tabulce:\n  UrbanAtlas_LK.FID\n  UrbanAtlas_LK.Shape\n  UrbanAtlas_LK.CODE\n  UrbanAtlas_LK.ITEM\n  UrbanAtlas_LK.SHAPE_AREA\n  coef.OID\n  coef.CODE\n  coef.nazev\n  coef.ko_vsak\n```\n\nJak je vidět, v tabulce vrstvy jsou názvy sloupců doplněny názvem tabulky, z níž sloupce pochází. Díky tomu se v této vrstvě můžeme odkazovat na sloupce z připojené tabulky.\n\n## Úloha 13: Použití připojených dat\n\n**Zadání:** Ve vrstvě s připojenou tabulkou vypočítejte pole \"ODTOK\" jako součin srážek, plochy a součinitele odtoku. Dloudobý roční srážkový normál je 860 mm.\n\n```python\n# Pokračujeme s vrstvou z předchozí úlohy\n\n# Přidání pole pro výpočet\n# POZOR: přidáváme do vrstvy, ne do původní datové sady!\narcpy.management.AddField(lyr, \"ODTOK\", \"DOUBLE\")\n\n# Výpočet s použitím polí z obou tabulek\n# Pozor na správné názvy s prefixem!\narcpy.management.CalculateField(\n    lyr,\n    \"ODTOK\",\n    '!UrbanAtlas_LK.shape.area! * !coef.ko_vsak! * 860',\n    \"PYTHON3\"\n)\n\nprint(\"Odtok vypočítán\")\n```\n\n::: {.callout-tip}\n## Prefixy u připojených polí\n\nPři práci s připojenými poli musíte používat **plné názvy s prefixem**:\n\n- `!NazevTabulky.NazevPole!` pro pole z připojené tabulky\n- `!NazevVrstvy.NazevPole!` pro pole z původní vrstvy\n\nBez prefixu by Python nevěděl, ze které tabulky pole vzít!\n:::\n\n## Úloha 14: Odstranění propojení\n\n**Zadání:** Odstraňte propojení z vrstvy.\n\nPokud již propojení tabulek dále nepotřebujeme, je třeba je z vrstvy odstranit nástrojem **Remove Join**:\n\n```python\n# Odstranění propojení\narcpy.management.RemoveJoin(lyr, \"coef\")\n\nprint(\"Propojení odstraněno\")\n\n# Ověření - výpis polí\nfor field in arcpy.ListFields(lyr):\n    print(field.name)\n```\n\nNamísto odstranění propojení je možné také vrstvu smazat. Nestačí ovšem použít pythonovský příkaz `del`, je nutné vrstvu smazat nástrojem **Delete**:\n\n```python\n# Smazání vrstvy\narcpy.management.Delete(lyr)\n\nprint(\"Vrstva smazána\")\n```\n\n## Trvalé propojení\n\nPokud chceme připojit pole trvale, máme dvě možnosti:\n\n1. Provedeme nejprve dočasné propojení výše uvedeným způsobem, a pak výslednou vrstvu uložíme do nové datové sady nástrojem **Copy Features**\n2. Připojíme pole přímo do tabulky zdrojové datové sady pomocí nástroje **Join Field**\n\n## Úloha 15: Trvalé připojení jednoho pole\n\n**Zadání:** K tabulce `Sidla.shp` trvale připojte pole POCET_OB z tabulky `Sidla_pocty.dbf`.\n\nNástroj **Join Field** připojí pole přímo do tabulky zdrojové datové sady. Zde je možné připojit buď všechna pole, nebo jen vybraná:\n\n```python\n# Trvalé připojení pole\narcpy.management.JoinField(\n    in_data=\"Sidla.shp\",\n    in_field=\"KOD\",\n    join_table=\"Sidla_pocty.dbf\",\n    join_field=\"KOD\",\n    fields=[\"POCET_OB\"]  # seznam polí k připojení\n)\n\nprint(\"Pole POCET_OB trvale připojeno\")\n```\n\n::: {.callout-warning}\n## Pozor - trvalá změna!\n\nNa rozdíl od `AddJoin`, nástroj `JoinField` **přímo mění** vstupní tabulku! Pole z připojené tabulky se stanou trvalou součástí cílové tabulky.\n:::\n\n## Úloha 16: Trvalé připojení více polí\n\n**Zadání:** K `Okresy_VUSC.shp` připojte název a kód kraje z tabulky `VUSC.shp`.\n\n```python\n# Připojení více polí najednou\narcpy.management.JoinField(\n    in_data=\"Okresy_VUSC.shp\",\n    in_field=\"KOD_VUSC\",\n    join_table=\"VUSC.shp\",\n    join_field=\"KOD_VUSC\",\n    fields=[\"NAZEV_VUSC\", \"KOD_VUSC\"]\n)\n\nprint(\"Informace o krajích připojeny\")\n```\n\n------------------------------------------------------------------------\n\n# Sumarizace tabulky\n\nSumarizace tabulky pomocí nástroje **Statistics** umožňuje vypočítat agregační statistiky (součet, průměr, minimum, maximum, počet) pro vybraná pole. Výsledkem je nová tabulka obsahující vypočítané hodnoty.\n\n## Úloha 17: Základní sumarizace\n\n**Zadání:** Spočítejte celkovou rozlohu všech katastrů v Libereckém kraji.\n\n```python\nkatastry = \"katastry_Liberec.shp\"\n\n# Nejprve musíme mít pole AREA_KM (viz úloha 8)\n# Pokud ho nemáme, vytvoříme ho:\narcpy.management.AddField(katastry, \"AREA_KM\", \"DOUBLE\")\narcpy.management.CalculateField(\n    katastry,\n    \"AREA_KM\",\n    '!shape.area!/1000000',\n    \"PYTHON3\"\n)\n\n# Sumarizace - celková plocha\narcpy.analysis.Statistics(\n    in_table=katastry,\n    out_table=\"stat_katastry_celkem\",\n    statistics_fields=[[\"AREA_KM\", \"SUM\"]]\n)\n\nprint(\"Statistiky vypočítány\")\n\n# Výpis výsledku\nwith arcpy.da.SearchCursor(\"stat_katastry_celkem\", [\"SUM_AREA_KM\"]) as cursor:\n    for row in cursor:\n        print(f\"Celková plocha katastrů: {row[0]:.2f} km²\")\n```\n\n**Parametry nástroje Statistics:**\n\n- `in_table` - vstupní tabulka\n- `out_table` - výstupní tabulka se statistikami\n- `statistics_fields` - seznam polí a funkcí: `[[\"pole\", \"funkce\"], ...]`\n- `case_field` - pole pro skupinování (volitelné)\n\n**Statistické funkce:**\n\n- `\"SUM\"` - součet\n- `\"MEAN\"` - průměr\n- `\"MIN\"` - minimum\n- `\"MAX\"` - maximum\n- `\"COUNT\"` - počet\n\n## Úloha 18: Sumarizace po skupinách\n\n**Zadání:** Spočítejte celkovou rozlohu a průměrnou rozlohu katastrů pro každý okres.\n\n```python\nkatastry = \"katastry_Liberec.shp\"\n\n# Nejprve musíme k datům připojit informaci o okresu\n# To provedeme pomocí JoinField z vrstvy okresů\narcpy.management.JoinField(\n    in_data=katastry,\n    in_field=\"KOD_OKRESU\",  # předpokládáme, že toto pole existuje\n    join_table=\"okresy.shp\",\n    join_field=\"KOD\",\n    fields=[\"NAZEV_OKRESU\"]\n)\n\n# Sumarizace podle okresů\narcpy.analysis.Statistics(\n    in_table=katastry,\n    out_table=\"stat_katastry_okresy\",\n    statistics_fields=[\n        [\"AREA_KM\", \"SUM\"],\n        [\"AREA_KM\", \"MEAN\"]\n    ],\n    case_field=\"NAZEV_OKRESU\"  # skupinování podle okresu\n)\n\nprint(\"Statistiky po okresech vypočítány\")\n\n# Výpis výsledků\nwith arcpy.da.SearchCursor(\"stat_katastry_okresy\", \n                          [\"NAZEV_OKRESU\", \"SUM_AREA_KM\", \"MEAN_AREA_KM\"]) as cursor:\n    print(f\"\\n{'Okres':<30} | {'Celková plocha':>15} | {'Průměrná plocha':>17}\")\n    print(\"-\" * 70)\n    for row in cursor:\n        print(f\"{row[0]:<30} | {row[1]:>15.2f} | {row[2]:>17.2f}\")\n```\n\n::: {.callout-note}\n## Parametr case_field\n\nKdyž použijete `case_field`, nástroj **Statistics** vytvoří jeden řádek výsledné tabulky pro každou **unikátní hodnotu** v tomto poli. Výsledky jsou tedy **seskupené podle hodnot** v case_field.\n\nBez `case_field` se sumarizuje celá tabulka do jednoho řádku.\n:::\n\n## Úloha 19: Kombinace funkcí\n\n**Zadání:** Pro každý typ krajinného pokryvu (Urban Atlas) spočítejte: počet plošek, celkovou plochu, průměrnou plochu, minimální a maximální plochu.\n\n```python\nurban_atlas = \"UrbanAtlas_LK.shp\"\n\n# Přidání pole AREA_KM\narcpy.management.AddField(urban_atlas, \"AREA_KM\", \"DOUBLE\")\narcpy.management.CalculateField(\n    urban_atlas,\n    \"AREA_KM\",\n    '!shape.area!/1000000',\n    \"PYTHON3\"\n)\n\n# Sumarizace s kombinací funkcí\narcpy.analysis.Statistics(\n    in_table=urban_atlas,\n    out_table=\"stat_landcover\",\n    statistics_fields=[\n        [\"AREA_KM\", \"COUNT\"],\n        [\"AREA_KM\", \"SUM\"],\n        [\"AREA_KM\", \"MEAN\"],\n        [\"AREA_KM\", \"MIN\"],\n        [\"AREA_KM\", \"MAX\"]\n    ],\n    case_field=\"CODE\"\n)\n\nprint(\"Statistiky krajinného pokryvu vypočítány\")\n```\n\n## Úloha 20: Připojení statistik zpět k původní tabulce\n\n**Zadání:** K původní tabulce katastrů připojte celkovou rozlohu okresu, ve kterém se katastr nachází. Poté vypočítejte podíl rozlohy katastru na rozloze okresu.\n\n```python\nkatastry = \"katastry_Liberec.shp\"\n\n# 1. Sumarizace - celková plocha okresů\narcpy.analysis.Statistics(\n    in_table=katastry,\n    out_table=\"stat_okresy\",\n    statistics_fields=[[\"AREA_KM\", \"SUM\"]],\n    case_field=\"KOD_OKRESU\"\n)\n\n# 2. Připojení výsledků zpět k původní tabulce\narcpy.management.JoinField(\n    in_data=katastry,\n    in_field=\"KOD_OKRESU\",\n    join_table=\"stat_okresy\",\n    join_field=\"KOD_OKRESU\",\n    fields=[\"SUM_AREA_KM\"]\n)\n\n# 3. Výpočet podílu\narcpy.management.AddField(katastry, \"PODIL_OKRESU\", \"DOUBLE\")\narcpy.management.CalculateField(\n    katastry,\n    \"PODIL_OKRESU\",\n    '!AREA_KM!/!SUM_AREA_KM!*100',\n    \"PYTHON3\"\n)\n\nprint(\"Podíl rozlohy na okresu vypočítán\")\n```\n\n------------------------------------------------------------------------\n\n# Komplexní úlohy - Python Notebook\n\n::: {.callout-important}\n## Python Notebook\n\n**Následující úlohy řešte v Python Notebooku**, ne v Python Window. Tyto úlohy kombinují techniky z celé lekce a vyžadují strukturovanější přístup.\n:::\n\n## Úloha 21: Analýza hustoty zalidnění\n\n**Zadání:** Pro každý okres spočítejte hustotu zalidnění (obyvatel/km²).\n\n**Data:**\n- `Okresy_VUSC.shp` - polygony okresů\n- `Sidla.shp` - bodová vrstva sídel\n- `Sidla_pocty.dbf` - tabulka s počty obyvatel\n\n**Postup:**\n\n::: {#d41f9acd .cell execution_count=1}\n``` {.python .cell-code}\nimport arcpy\n\n# Nastavení\narcpy.env.workspace = r\"C:\\TEMP\\Python_GIS\\Lekce_14\"\narcpy.env.overwriteOutput = True\n\nprint(\"=\" * 60)\nprint(\"ANALÝZA HUSTOTY ZALIDNĚNÍ OKRESŮ\")\nprint(\"=\" * 60)\n\n# 1. Výpočet plochy okresů\nprint(\"\\n1. Počítám plochu okresů...\")\nokresy = \"Okresy_VUSC.shp\"\n\narcpy.management.AddField(okresy, \"AREA_KM\", \"DOUBLE\")\narcpy.management.CalculateField(\n    okresy,\n    \"AREA_KM\",\n    '!shape.area!/1000000',\n    \"PYTHON3\"\n)\nprint(\"   OK\")\n\n# 2. Připojení počtu obyvatel k sídlům\nprint(\"\\n2. Připojuji počty obyvatel k sídlům...\")\nsidla = \"Sidla.shp\"\n\narcpy.management.JoinField(\n    in_data=sidla,\n    in_field=\"KOD\",\n    join_table=\"Sidla_pocty.dbf\",\n    join_field=\"KOD\",\n    fields=[\"POCET_OB\"]\n)\nprint(\"   OK\")\n\n# 3. Spatial Join - připojení kódu okresu k sídlům\nprint(\"\\n3. Přiřazuji sídla k okresům (Spatial Join)...\")\nsidla_okresy = \"sidla_s_okresy.shp\"\n\narcpy.analysis.SpatialJoin(\n    target_features=sidla,\n    join_features=okresy,\n    out_feature_class=sidla_okresy,\n    join_type=\"KEEP_COMMON\",\n    match_option=\"WITHIN\"\n)\nprint(\"   OK\")\n\n# 4. Sumarizace - součet obyvatel pro každý okres\nprint(\"\\n4. Sumarizuji počty obyvatel podle okresů...\")\narcpy.analysis.Statistics(\n    in_table=sidla_okresy,\n    out_table=\"stat_obyvatele_okresy\",\n    statistics_fields=[[\"POCET_OB\", \"SUM\"]],\n    case_field=\"KOD_OKRESU\"\n)\nprint(\"   OK\")\n\n# 5. Připojení počtu obyvatel k okresům\nprint(\"\\n5. Připojuji počty obyvatel k okresům...\")\narcpy.management.JoinField(\n    in_data=okresy,\n    in_field=\"KOD\",\n    join_table=\"stat_obyvatele_okresy\",\n    join_field=\"KOD_OKRESU\",\n    fields=[\"SUM_POCET_OB\"]\n)\nprint(\"   OK\")\n\n# 6. Výpočet hustoty zalidnění\nprint(\"\\n6. Počítám hustotu zalidnění...\")\narcpy.management.AddField(okresy, \"HUSTOTA\", \"DOUBLE\")\narcpy.management.CalculateField(\n    okresy,\n    \"HUSTOTA\",\n    '!SUM_POCET_OB!/!AREA_KM!',\n    \"PYTHON3\"\n)\nprint(\"   OK\")\n\n# 7. Výpis výsledků\nprint(\"\\n\" + \"=\" * 60)\nprint(\"VÝSLEDKY - HUSTOTA ZALIDNĚNÍ\")\nprint(\"=\" * 60)\n\nwith arcpy.da.SearchCursor(okresy, \n                          [\"NAZEV_OKRESU\", \"SUM_POCET_OB\", \"AREA_KM\", \"HUSTOTA\"],\n                          sql_clause=(None, \"ORDER BY HUSTOTA DESC\")) as cursor:\n    print(f\"\\n{'Okres':<30} | {'Obyvatel':>10} | {'Plocha (km²)':>12} | {'Hustota':>10}\")\n    print(\"-\" * 70)\n    for row in cursor:\n        if row[1] is not None:  # kontrola, že má data\n            print(f\"{row[0]:<30} | {row[1]:>10.0f} | {row[2]:>12.2f} | {row[3]:>10.2f}\")\n\nprint(\"\\n\" + \"=\" * 60)\nprint(\"ANALÝZA DOKONČENA\")\nprint(\"=\" * 60)\n```\n:::\n\n\n## Úloha 22: Dávkové zpracování - kategorizace obcí\n\n**Zadání:** Pro všechny kraje v ČR vytvořte nové shapefily s kategorizací obcí podle velikosti.\n\n**Kategorie:**\n- Malé obce: < 500 obyvatel\n- Střední obce: 500-5000 obyvatel\n- Velké obce: > 5000 obyvatel\n\n**Postup:**\n\n::: {#16d015cf .cell execution_count=2}\n``` {.python .cell-code}\nimport arcpy\nimport os\n\n# Nastavení\narcpy.env.workspace = r\"C:\\TEMP\\Python_GIS\\Lekce_14\"\narcpy.env.overwriteOutput = True\n\n# Výstupní složka\noutput_folder = r\"C:\\TEMP\\Python_GIS\\Lekce_14\\kategorie_obci\"\nif not os.path.exists(output_folder):\n    os.makedirs(output_folder)\n\nprint(\"=\" * 60)\nprint(\"KATEGORIZACE OBCÍ PODLE KRAJŮ\")\nprint(\"=\" * 60)\n\n# Data\nobce = \"obce_LK.shp\"  # nebo obecnější data ze všech krajů\nkraje = \"VUSC.shp\"\n\n# Vytvoření vrstvy krajů\nkraje_lyr = arcpy.management.MakeFeatureLayer(kraje, \"kraje_layer\")\n\n# Získání seznamu krajů\nkraje_list = []\nwith arcpy.da.SearchCursor(kraje_lyr, [\"NAZEV_VUSC\", \"KOD_VUSC\"]) as cursor:\n    for row in cursor:\n        kraje_list.append((row[0], row[1]))\n\nprint(f\"\\nNalezeno krajů: {len(kraje_list)}\")\n\n# Zpracování každého kraje\nfor nazev_kraje, kod_kraje in kraje_list:\n    print(f\"\\n{'='*60}\")\n    print(f\"Zpracovávám: {nazev_kraje}\")\n    print(f\"{'='*60}\")\n    \n    try:\n        # 1. Výběr obce v kraji (pomocí Spatial Join nebo Select by Location)\n        obce_lyr = arcpy.management.MakeFeatureLayer(obce, \"obce_layer\")\n        \n        # Výběr kraje\n        arcpy.management.SelectLayerByAttribute(\n            kraje_lyr,\n            \"NEW_SELECTION\",\n            f\"KOD_VUSC = {kod_kraje}\"\n        )\n        \n        # Výběr obcí v kraji\n        arcpy.management.SelectLayerByLocation(\n            obce_lyr,\n            \"WITHIN\",\n            kraje_lyr\n        )\n        \n        # Zjištění počtu obcí v kraji\n        count = int(arcpy.management.GetCount(obce_lyr).getOutput(0))\n        print(f\"  Obcí v kraji: {count}\")\n        \n        if count == 0:\n            print(\"  Přeskakuji - žádné obce\")\n            continue\n        \n        # 2. Vytvoření shapefilů pro jednotlivé kategorie\n        \n        # Malé obce (< 500)\n        arcpy.management.SelectLayerByAttribute(\n            obce_lyr,\n            \"NEW_SELECTION\",\n            \"OBYVATEL < 500\"\n        )\n        count_male = int(arcpy.management.GetCount(obce_lyr).getOutput(0))\n        if count_male > 0:\n            output_male = os.path.join(output_folder, \n                                      f\"obce_{nazev_kraje}_male.shp\")\n            arcpy.management.CopyFeatures(obce_lyr, output_male)\n            print(f\"  Malé obce: {count_male} → {output_male}\")\n        \n        # Střední obce (500-5000)\n        arcpy.management.SelectLayerByLocation(\n            obce_lyr,\n            \"WITHIN\",\n            kraje_lyr\n        )\n        arcpy.management.SelectLayerByAttribute(\n            obce_lyr,\n            \"NEW_SELECTION\",\n            \"OBYVATEL >= 500 AND OBYVATEL <= 5000\"\n        )\n        count_stredni = int(arcpy.management.GetCount(obce_lyr).getOutput(0))\n        if count_stredni > 0:\n            output_stredni = os.path.join(output_folder, \n                                         f\"obce_{nazev_kraje}_stredni.shp\")\n            arcpy.management.CopyFeatures(obce_lyr, output_stredni)\n            print(f\"  Střední obce: {count_stredni} → {output_stredni}\")\n        \n        # Velké obce (> 5000)\n        arcpy.management.SelectLayerByLocation(\n            obce_lyr,\n            \"WITHIN\",\n            kraje_lyr\n        )\n        arcpy.management.SelectLayerByAttribute(\n            obce_lyr,\n            \"NEW_SELECTION\",\n            \"OBYVATEL > 5000\"\n        )\n        count_velke = int(arcpy.management.GetCount(obce_lyr).getOutput(0))\n        if count_velke > 0:\n            output_velke = os.path.join(output_folder, \n                                       f\"obce_{nazev_kraje}_velke.shp\")\n            arcpy.management.CopyFeatures(obce_lyr, output_velke)\n            print(f\"  Velké obce: {count_velke} → {output_velke}\")\n        \n        print(f\"  OK - Kraj zpracován\")\n        \n    except Exception as e:\n        print(f\"  CHYBA: {str(e)}\")\n    \n    finally:\n        # Vyčištění výběrů\n        arcpy.management.SelectLayerByAttribute(obce_lyr, \"CLEAR_SELECTION\")\n        arcpy.management.SelectLayerByAttribute(kraje_lyr, \"CLEAR_SELECTION\")\n\n# Smazání vrstev\narcpy.management.Delete(obce_lyr)\narcpy.management.Delete(kraje_lyr)\n\nprint(\"\\n\" + \"=\" * 60)\nprint(\"DÁVKOVÉ ZPRACOVÁNÍ DOKONČENO\")\nprint(\"=\" * 60)\nprint(f\"Výstupní složka: {output_folder}\")\n```\n:::\n\n\n------------------------------------------------------------------------\n\n# Shrnutí\n\n## Co jsme se naučili\n\n**Práce s vrstvami:**\n\n- `MakeFeatureLayer()` - vytváření vrstev v paměti\n- `MakeTableView()` - vytváření tabulkových pohledů\n- `SelectLayerByAttribute()` - SQL dotazy na vrstvy\n- `Delete()` - mazání vrstev (odemknutí dat)\n\n**Práce s poli:**\n\n- `AddField()` - přidávání polí do tabulky\n- `DeleteField()` - mazání polí\n- `CalculateField()` - výpočet hodnot polí\n  - Konstanty: `100`, `\"text\"`\n  - Odkaz na pole: `!NAZEV!`\n  - Geometrie: `!shape.area!`, `!shape.length!`\n  - Python výrazy: `.upper()`, `.lower()`, matematika\n\n**Propojování tabulek:**\n\n- `AddJoin()` - dočasné propojení (v rámci vrstvy)\n- `RemoveJoin()` - odstranění dočasného propojení\n- `JoinField()` - trvalé připojení polí (mění zdrojová data!)\n- Prefixy u připojených polí: `!TabulkaA.pole!`\n\n**Sumarizace:**\n\n- `Statistics()` - agregační funkce (SUM, MEAN, MIN, MAX, COUNT)\n- `case_field` - sumarizace po skupinách\n- Kombinace více funkcí v jednom volání\n- Připojení výsledků zpět k původní tabulce\n\n**SQL syntaxe v ArcGIS:**\n\n- Porovnání: `=`, `<>`, `>`, `<`, `>=`, `<=`\n- Vzory: `LIKE '%text%'`\n- Logika: `AND`, `OR`, `NOT`\n- Seznamy: `IN (val1, val2, ...)`\n\n## Klíčové koncepty\n\n1. **Vrstvy vs. datové sady** - vrstva je dočasný pohled v paměti, datová sada je fyzický soubor\n\n2. **Dočasné vs. trvalé propojení** - AddJoin je dočasné (v rámci vrstvy), JoinField je trvalé (mění data)\n\n3. **Uvozovky v CalculateField** - vnější `'` pro celý výraz, vnitřní `\"` pro textové konstanty\n\n4. **Prefixy u připojených polí** - `!NazevTabulky.NazevPole!` pro jednoznačnou identifikaci\n\n5. **Statistics vytváří novou tabulku** - výsledek je samostatná tabulka, ne modifikace původní\n\n6. **Zamykání dat vrstvami** - MakeFeatureLayer zamkne data, Delete odemkne\n\n------------------------------------------------------------------------\n\n# Domácí úkol\n\n## Varianta A (základní)\n\n**Zadání:** Analýza silniční sítě podle okresů.\n\nPro každý okres spočítejte:\n1. Celkovou délku silnic (v km)\n2. Průměrnou délku silničních úseků\n3. Počet silničních úseků\n\n**Data:** `Silnice.shp`, `Okresy_VUSC.shp`\n\n**Postup:**\n1. Vypočítat délku silnic (LENGTH_KM)\n2. Spatial Join - připojit kód okresu k silnicím\n3. Statistics - sumarizovat podle okresů\n4. Vyexportovat výsledky do CSV\n\n**Odevzdejte:** Skript `analyza_silnic.py` + CSV s výsledky\n\n## Varianta B (střední)\n\n**Zadání:** Kategorizace katastrů podle tvaru.\n\nVytvořte kategorie katastrů podle tvaru (PA_RATIO):\n- Kompaktní: PA_RATIO < 0.001\n- Střední: 0.001 <= PA_RATIO < 0.002\n- Členité: PA_RATIO >= 0.002\n\nPro každou kategorii:\n1. Spočítejte počet katastrů\n2. Spočítejte celkovou a průměrnou rozlohu\n3. Vytvořte samostatný shapefile\n\n**Data:** `katastry_Liberec.shp`\n\n**Odevzdejte:** Python Notebook `kategorizace_katastru.ipynb` + 3 shapefily\n\n## Varianta C (pokročilá)\n\n**Zadání:** Komplexní analýza krajinného pokryvu.\n\nPro každý okres v Libereckém kraji vytvořte report o krajinném pokryvu:\n\n1. Pro každý typ pokryvu (Urban Atlas):\n   - Celková plocha\n   - Počet plošek\n   - Průměrná velikost plošky\n   - PA_RATIO (průměr, min, max)\n\n2. Identifikujte dominantní typ pokryvu v každém okrese (největší plocha)\n\n3. Spočítejte fragmentaci krajiny:\n   - Počet plošek / celková plocha\n   \n4. Vytvořte HTML report s tabulkami a grafem (matplotlib)\n\n**Data:** `UrbanAtlas_LK.shp`, `okresy.shp`\n\n**Bonusově:**\n- Graf: zastoupení typů pokryvu v každém okrese (stacked bar chart)\n- Mapa: okresy obarvené podle dominantního typu pokryvu\n\n**Odevzdejte:** Notebook `analyza_krajiny.ipynb` + HTML report\n\n------------------------------------------------------------------------\n\n# Poznámky pro vyučujícího\n\n## Časový plán (90 min)\n\n| Čas       | Obsah                                          |\n|-----------|------------------------------------------------|\n| 0-5 min   | Úvod, rozdíl vrstvy vs. datová sada            |\n| 5-20 min  | Úlohy 1-4 (MakeFeatureLayer, Select)          |\n| 20-40 min | Úlohy 5-11 (AddField, CalculateField)         |\n| 40-60 min | Úlohy 12-16 (Join operace)                    |\n| 60-75 min | Úlohy 17-20 (Statistics)                      |\n| 75-85 min | Úloha 21 v Notebooku - struktura řešení       |\n| 85-90 min | Shrnutí, domácí úkol                          |\n\n## Klíčové momenty\n\n### Úlohy 1-4 (5-20 min):\n\n- **ZDŮRAZNIT:** Rozdíl mezi vrstvou (v paměti) a datovou sadou (na disku)\n- **UKÁZAT:** MakeFeatureLayer krok za krokem\n- **DŮLEŽITÉ:** Zamykání dat - vrstva zamkne datovou sadu\n- **PRAKTICKÉ:** SQL syntaxe v ArcGIS (LIKE, AND, OR)\n- **VIZUÁLNÍ:** Kontrola výběrů v ArcGIS Pro\n\n### Úlohy 5-11 (20-40 min):\n\n- **ZAČÍT:** Jednoduchý příklad s AddField\n- **ZDŮRAZNIT:** Uvozovky v CalculateField (`'\"text\"'`)\n- **UKÁZAT:** Odkaz na pole pomocí `!POLE!`\n- **PRAKTICKÉ:** shape.area a shape.length\n- **TIP:** Převody jednotek (dělení 1000000 pro km²)\n\n### Úlohy 12-16 (40-60 min):\n\n- **UKÁZAT:** AddJoin krok za krokem\n- **DŮLEŽITÉ:** Prefixy u připojených polí\n- **ZDŮRAZNIT:** Rozdíl mezi AddJoin (dočasné) a JoinField (trvalé)\n- **POZOR:** JoinField mění původní data!\n- **PRAKTICKÉ:** Kdy použít který typ propojení\n\n### Úlohy 17-20 (60-75 min):\n\n- **UKÁZAT:** Statistics bez case_field\n- **POROVNAT:** Statistics s case_field\n- **DŮLEŽITÉ:** Statistics vytváří NOVOU tabulku\n- **PRAKTICKÉ:** Kombinace Statistics + JoinField\n- **TIP:** Použití sql_clause pro řazení výsledků\n\n### Úloha 21 (75-85 min):\n\n- **PŘEPNOUT:** Do Python Notebooku\n- **UKÁZAT:** Strukturu komplexní analýzy (komentáře, výpisy průběhu)\n- **ZDŮRAZNIT:** Kombinace technik z celé lekce\n- **NECHAT:** Studenty adaptovat kód pro vlastní analýzu\n\n## Rizika\n\n1. **Studenti zapomínají vytvořit vrstvu před Select**\n   - Řešení: Zdůraznit, že Select pracuje s vrstvami, ne datovými sadami\n\n2. **Špatné uvozovky v CalculateField**\n   - Řešení: Napsat na tabuli vzor: `'\"textová_konstanta\"'`\n   - Ukázat chybovou hlášku a správné řešení\n\n3. **Nesprávné názvy polí v AddJoin**\n   - Řešení: Ukázat ListFields() pro výpis správných názvů s prefixy\n\n4. **Zapomínají smazat vrstvy (zamčená data)**\n   - Řešení: Důsledně ukazovat Delete() na konci každé sekce\n\n5. **Nedostatek času na Notebook úlohy**\n   - Řešení: Úloha 21 jen struktura, úloha 22 jako domácí úkol\n\n6. **SQL syntaxe - studenti míchají Python a SQL**\n   - Řešení: Zdůraznit rozdíl, ukázat příklady\n\n## Tipy\n\n- **Vizuální kontrola:** Po každé úloze zkontrolovat výsledek v atributové tabulce\n- **Data:** Mít připravená data, otestovat všechny skripty předem\n- **ListFields():** Používat často pro kontrolu názvů polí\n- **GetCount():** Používat pro kontrolu počtu vybraných prvků\n- **Cheatsheet:** Rozdat vytištěný cheatsheet se SQL syntaxí\n- **Propojení s GUI:** Ukázat, jak se operace dělají v GUI vs. Python\n\n## Běžné chyby studentů\n\n```python\n# 1. Zapomínají vytvořit vrstvu před Select\narcpy.management.SelectLayerByAttribute(\"shapefile.shp\", ...)  # CHYBA!\n# Správně:\nlyr = arcpy.management.MakeFeatureLayer(\"shapefile.shp\", \"layer\")\narcpy.management.SelectLayerByAttribute(lyr, ...)\n\n# 2. Špatné uvozovky v CalculateField\narcpy.management.CalculateField(tbl, \"POLE\", \"text\")  # CHYBA!\n# Správně:\narcpy.management.CalculateField(tbl, \"POLE\", '\"text\"')\n\n# 3. Zapomínají prefix u připojených polí\narcpy.management.CalculateField(lyr, \"VYSL\", '!pole1! * !pole2!')  # CHYBA!\n# Správně:\narcpy.management.CalculateField(lyr, \"VYSL\", '!tabulka1.pole1! * !tabulka2.pole2!')\n\n# 4. Nesprávná jednotka u shape.area\n# shape.area je v m², ne v km²!\narcpy.management.CalculateField(tbl, \"AREA\", '!shape.area!')  # v m²\n# Pro km²:\narcpy.management.CalculateField(tbl, \"AREA_KM\", '!shape.area!/1000000')\n\n# 5. Zapomínají PYTHON3 u CalculateField s Python výrazy\narcpy.management.CalculateField(tbl, \"POLE\", '!TEXT!.upper()')  # CHYBA!\n# Správně:\narcpy.management.CalculateField(tbl, \"POLE\", '!TEXT!.upper()', \"PYTHON3\")\n```\n\n## Materiály k přípravě\n\n- [ ] Všechna data připravená a otestovaná\n- [ ] SQL syntaxe cheatsheet (vytisknout)\n- [ ] Diagram: vrstvy vs. datové sady\n- [ ] Diagram: AddJoin vs. JoinField\n- [ ] Tabulka: datové typy polí\n- [ ] Vzorový Notebook pro úlohu 21\n- [ ] Řešení všech domácích úkolů (A, B, C)\n- [ ] Screenshot: ListFields() s prefixy\n\n------------------------------------------------------------------------\n\n# Cheatsheet - Atributové operace\n\n## Vrstvy\n\n```python\n# Vytvoření vrstvy\nlyr = arcpy.management.MakeFeatureLayer(\"data.shp\", \"layer_name\")\n\n# Tabulkový pohled\nview = arcpy.management.MakeTableView(\"table.dbf\", \"view_name\", \"WHERE_CLAUSE\")\n\n# Smazání vrstvy (odemkne data)\narcpy.management.Delete(lyr)\n```\n\n## Výběry\n\n```python\n# Nový výběr\narcpy.management.SelectLayerByAttribute(\n    lyr, \n    \"NEW_SELECTION\", \n    \"POLE > 100 AND TEXT LIKE '%vzor%'\"\n)\n\n# Zjištění počtu vybraných\ncount = int(arcpy.management.GetCount(lyr).getOutput(0))\n\n# Vyčištění výběru\narcpy.management.SelectLayerByAttribute(lyr, \"CLEAR_SELECTION\")\n```\n\n## Pole\n\n```python\n# Přidání pole\narcpy.management.AddField(table, \"POLE\", \"DOUBLE\")\n\n# Smazání pole\narcpy.management.DeleteField(table, \"POLE\")\n\n# Výpočet - konstanta\narcpy.management.CalculateField(table, \"POLE\", 100)\narcpy.management.CalculateField(table, \"TEXT\", '\"konstanta\"')\n\n# Výpočet - z jiného pole\narcpy.management.CalculateField(\n    table, \n    \"VYSLEDEK\", \n    '!POLE1! + !POLE2!', \n    \"PYTHON3\"\n)\n\n# Geometrie\narcpy.management.CalculateField(table, \"AREA_KM\", '!shape.area!/1000000', \"PYTHON3\")\narcpy.management.CalculateField(table, \"LENGTH_KM\", '!shape.length!/1000', \"PYTHON3\")\n```\n\n## Propojení\n\n```python\n# Dočasné propojení (v paměti)\nlyr = arcpy.management.MakeFeatureLayer(\"data.shp\", \"layer\")\narcpy.management.AddJoin(lyr, \"KEY_FIELD\", \"table.dbf\", \"KEY_FIELD\")\n# Práce s připojenými poli: !table.field!\narcpy.management.RemoveJoin(lyr, \"table\")\n\n# Trvalé připojení (mění data!)\narcpy.management.JoinField(\n    \"data.shp\", \n    \"KEY_FIELD\", \n    \"table.dbf\", \n    \"KEY_FIELD\", \n    [\"POLE1\", \"POLE2\"]\n)\n```\n\n## Sumarizace\n\n```python\n# Celá tabulka\narcpy.analysis.Statistics(\n    \"input.shp\",\n    \"output_stats\",\n    [[\"POLE\", \"SUM\"], [\"POLE\", \"MEAN\"]]\n)\n\n# Po skupinách\narcpy.analysis.Statistics(\n    \"input.shp\",\n    \"output_stats\",\n    [[\"POLE\", \"SUM\"]],\n    \"GROUP_FIELD\"\n)\n\n# Funkce: SUM, MEAN, MIN, MAX, COUNT\n```\n\n## SQL syntaxe\n\n```python\n# Porovnání\n\"POLE = 100\"\n\"POLE <> 100\"\n\"POLE > 100\"\n\"POLE <= 100\"\n\n# Rozsah\n\"POLE BETWEEN 10 AND 100\"\n\n# Text\n\"TEXT = 'Praha'\"\n\"TEXT LIKE '%vzor%'\"  # % = libovolné znaky\n\n# Logika\n\"POLE1 > 100 AND POLE2 < 200\"\n\"TEXT = 'A' OR TEXT = 'B'\"\n\"NOT (POLE IS NULL)\"\n\n# Seznam\n\"POLE IN (1, 2, 3)\"\n```\n\n",
    "supporting": [
      "lesson_14_files\\figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}